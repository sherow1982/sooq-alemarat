<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">فئة منتجات - سوق الإمارات</title>
    <meta name="description" id="page-description" content="تسوق منتجات مميزة مع شحن مجاني ودفع عند الاستلام داخل الإمارات">
    <link rel="canonical" id="page-canonical" href="https://sherow1982.github.io/sooq-alemarat/category.html">
    <link rel="icon" href="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/e1029c77-e4a0-4b40-a278-4b4996e2ee05.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/improved-theme.css">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: https:; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https: http:; font-src 'self' https:; connect-src 'self' https:; frame-src 'none'; object-src 'none'; base-uri 'self';">
</head>
<body>
    <!-- ... بقية الهيدر والمحتوى بدون تغيير ... -->

    <!-- Scripts: ترتيب التحميل الصحيح -->
    <script src="js/extension-detector.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/responsive-cards.js"></script>
    
    <script>
        class UniversalCategoryPage {
            constructor() {
                this.categoryName = '';
                this.categorySlug = '';
                this.products = [];
                this.filteredProducts = [];
                this.currentFilter = 'all';
                // بدلاً من this.init()
                this.bootstrap();
            }
            
            bootstrap(){
                try{
                  this.extractCategoryInfo?.();
                  this.updatePageElements?.();
                  this.loadProducts?.();
                  this.setupFilters?.();
                }catch(e){ console.error('Bootstrap error:', e); }
            }
            
            renderProducts() {
                const container = document.getElementById('category-products');
                if (!container) return;
                if (this.filteredProducts.length === 0) { this.showEmptyState?.(); return; }
                const productsHTML = this.filteredProducts.map(p => this.createProductCard?.(p) || '').join('');
                container.innerHTML = productsHTML;
                container.classList.add('products-fade-in');
                try {
                    if (window.responsiveCards && typeof window.responsiveCards.setupProductCardEvents === 'function') {
                        window.responsiveCards.setupProductCardEvents();
                    }
                } catch (e) {
                    console.warn('responsiveCards not available, skipping enhancements');
                }
            }
        }
        window.filterByPrice = function(filter, button) {
            if (window.categoryPage) {
                window.categoryPage.applyFilter?.(filter);
                window.categoryPage.renderProducts?.();
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            }
        };
        document.addEventListener('DOMContentLoaded', function() {
            window.categoryPage = new UniversalCategoryPage();
        });
    </script>
    <!-- أنماط إضافية كما هي -->
</body>
</html>